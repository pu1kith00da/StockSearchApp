<!DOCTYPE html>
<html>

<head>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/drag-panes.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/stock/indicators/indicators.js"></script>
    <script src="https://code.highcharts.com/stock/indicators/volume-by-price.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <SCRIPT LANGUAGE="JavaScript">

        function setData(jsonData, ticker) {
            (async () => {
                var data = jsonData.mainChartData;
                
                var ohlc = [];
                var volume = [];
                var dataLength = data.length;
                // set the allowed units for data grouping
                var groupingUnits = [
                                     ['week', [1]], // unit name, allowed multiples
                                     ['month', [1, 2, 3, 4, 6]],
                                     ];
                                     
                                     for (let i = 0; i < dataLength; i += 1) {
                                         // Pushing OHLC data
                                         ohlc.push([
                                                    data[i][0], // the date
                                                    data[i][1], // open
                                                    data[i][2], // high
                                                    data[i][3], // low
                                                    data[i][4], // close
                                                    ]);
                                                    
                                                    // Pushing volume data
                                                    volume.push([
                                                                 data[i][0], // the date
                                                                 data[i][5], // the volume
                                                                 ]);
                                     }
                                     Highcharts.chart('container', {
                                         rangeSelector: {
                                             selected: 2,
                                         },
                                         
                                         title: {
                                             text: ticker + ' Historical',
                                         },
                                         
                                         subtitle: {
                                             text: 'With SMA and Volume by Price technical indicators',
                                         },
                                         
                                         yAxis: [
                                                 {
                                                     startOnTick: false,
                                                     endOnTick: false,
                                                     labels: {
                                                         align: 'right',
                                                         x: -3,
                                                     },
                                                     title: {
                                                         text: 'OHLC',
                                                     },
                                                     height: '60%',
                                                     lineWidth: 2,
                                                     resize: {
                                                         enabled: true,
                                                     },
                                                 },
                                                 {
                                                     labels: {
                                                         align: 'right',
                                                         x: -3,
                                                     },
                                                     title: {
                                                         text: 'Volume',
                                                     },
                                                     top: '65%',
                                                     height: '35%',
                                                     offset: 0,
                                                     lineWidth: 2,
                                                 },
                                                 ],
                                                 
                                                 tooltip: {
                                                     split: true,
                                                 },
                                                 
                                                 plotOptions: {
                                                     series: {
                                                         dataGrouping: {
                                                             units: groupingUnits,
                                                         },
                                                     },
                                                 },
                                                 
                                                 series: [
                                                          {
                                                              type: 'candlestick',
                                                              name: ticker,
                                                              id: ticker,
                                                              zIndex: 2,
                                                              data: ohlc,
                                                          },
                                                          {
                                                              type: 'column',
                                                              name: 'Volume',
                                                              id: 'volume',
                                                              data: volume,
                                                              yAxis: 1,
                                                          },
                                                          //SMA and VBP graphs still annoying
                                                          
                                                          {
                                                              type: 'vbp',
                                                              linkedTo: ticker,
                                                              params: {
                                                                  volumeSeriesID: 'volume',
                                                              },
                                                              dataLabels: {
                                                                  enabled: false,
                                                              },
                                                              zoneLines: {
                                                                  enabled: false,
                                                              },
                                                          },
                                                          {
                                                              type: 'sma',
                                                              linkedTo: ticker,
                                                              zIndex: 1,
                                                              marker: {
                                                                  enabled: false,
                                                              }
                                                          }]
                                     });
            })();
        }
    </SCRIPT>

</head>

<body>
    <div id="container" style="height: 900px;"></div>
</body>

</html>
